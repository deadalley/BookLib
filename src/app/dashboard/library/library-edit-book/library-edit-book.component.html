<loading [visible]="(loadingBook  || loadingCollections)"></loading>
<page-navigator *ngIf="!(loadingBook  || loadingCollections)">
	<div class="card" [@card]>
		<div class="header">
			<h4 class="title">{{title}}</h4>
			<p class="category" placement="bottom">{{description}}</p>
		</div>

		<div class="content">
			<form [formGroup]="form" (ngSubmit)="submit(form.value)">
				<!-- Image -->
				<div class="image book-image" *ngIf="showImage">
          <img
            [src]="book.imageLarge ? book.imageLarge : (book.imageSmall ? book.imageSmall : '/assets/img/no-book-cover.png')"
            alt="Book cover"
          >
				</div>

				<div class="row">
					<div class="col-md-6">
						<!-- Title -->
						<div class="form-group" [ngClass] = "{'has-error': !form.controls['title'].valid && form.controls['title'].touched}">
							<label>Book Title *</label>
							<div style="display: flex">
								<div style="width: 100%">
									<input type="text" class="form-control" placeholder="Your version title" formControlName="title">
									<span class="help-block" *ngIf="!form.controls['title'].valid && form.controls['title'].touched">
										Please enter a valid book title.
									</span>
								</div>
								<button type="button"
									(click)="searchBookOnGoodreads(bookTitle)"
									class="btn btn-default"
									style="margin-left: 13px"
									tooltip="Search Goodreads"
									[isDisabled]="false"
									[tooltipAnimation]="true"
									placement="bottom">
									<span class="pe-7s-search" aria-hidden="true" style="font-size: 1.2em;"></span>
								</button>
							</div>
						</div>
					</div>
					<!-- Original title -->
					<div class="col-md-6">
						<div class="form-group">
							<label>Original Title</label>
							<input type="text" class="form-control" placeholder="Original version title" formControlName="original">
						</div>
					</div>
				</div>
				<!-- Suggested books -->
				<div *ngIf="suggestedBooks && suggestedBooks.length > 0" class="row">
					<div class="col-xs-12">
						<label style="padding:0;">Books found</label>
						<a href="javascript:void(0);" (click)="suggestedBooks=[]">
							<i class="pe-7s-close-circle" style="font-size: 100%"></i>
						</a>
					</div>
				</div>
				<div style="padding-left: 10px">
					<books-display
						[books]="suggestedBooks"
						[clickable]="true"
						(selectedBook)="selectBook($event)"
					></books-display>
				</div>

				<!-- Author -->
				<div class="form-group">
					<label>Author</label>
					<div class="row">
						<div class="col-md-3" *ngIf="author">
							<!-- Author image -->
							<div class="image author-image">
								<img
									[src]="author.imageLarge ? author.imageLarge : (author.imageSmall ? author.imageSmall : '/assets/img/no-book-cover.png')"
									alt="Author photo"
								>
							</div>
						</div>
						<div class="col-xs-12" [ngClass]="{'col-md-12': !author, 'col-md-9': !!author}">
							<!-- Name -->
							<div class="form-group" [ngClass] = "{'has-error': !form.controls['author'].valid && form.controls['author'].touched}">
								<label>Name *</label>
								<div style="display: flex">
									<div style="width: 100%">
										<input type="text" class="form-control" placeholder="Author name" formControlName="author">
										<span class="help-block" *ngIf="!form.controls['author'].valid && form.controls['author'].touched">
											Please enter a valid author name.
										</span>
									</div>								
									<button type="button"
										(click)="searchAuthorOnGoodreads(authorName)"
										class="btn btn-default"
										style="margin-left: 13px"
										tooltip="Search Goodreads"
										[isDisabled]="false"
										[tooltipAnimation]="true"
										placement="bottom">
										<span class="pe-7s-search" aria-hidden="true" style="font-size: 1.2em;"></span>
									</button>
								</div>
								<!-- Author Watch --
								<button type="button"
									(click)="form.controls['authorWatch'].setValue(!form.controls['authorWatch'].value)"
									[ngClass] = "{'active': form.controls['authorWatch'].value}"
									class="library-button btn btn-default"
									style="vertical-align: center; font-size=1.2em"
									tooltip="Add this author to your watch list"
									[isDisabled]="false"
									[tooltipAnimation]="true"
									placement="bottom">
									<span class="pe-7s-look" aria-hidden="true" style="font-size: 1.2em;"></span>
								</button> -->
							</div>
							<!-- Author bio -->
							<p *ngIf="author" [innerHTML]="author.about | truncate: { paragraphs: 1 }"></p>
						</div>
					</div>

					<!-- Suggested authors -->
					<div *ngIf="suggestedAuthors && suggestedAuthors.length > 0" class="row">
						<div class="col-xs-12">
							<label style="padding:0">Authors found</label>
							<a href="javascript:void(0);" (click)="suggestedAuthors=[]">
								<i class="pe-7s-close-circle" style="font-size: 100%"></i>
							</a>
						</div>
					</div>
					<div class="row">
						<grid [items]="(suggestedAuthors || []).slice(0,4)">
							<ng-template let-author>
								<author-card
									[author]="author"
									(selected)="selectAuthor($event)"
								></author-card>
							</ng-template>
						</grid>
					</div>
				</div>

				<!-- Other form values -->
				<div class="row">
					<div class="col-md-8">
						<!-- Publisher -->
						<div class="form-group">
							<label>Publisher</label>
							<input type="text" class="form-control" placeholder="Publisher" formControlName="publisher">
						</div>
					</div>
					<div class="col-md-2">
						<!-- Year -->
						<div class="form-group" [ngClass] = "{'has-error': !form.controls['year'].valid && form.controls['year'].touched}">
							<label>Year</label>
							<input type="number" class="form-control" placeholder="Year" formControlName="year">
							<span class="help-block" *ngIf="!form.controls['year'].valid && form.controls['year'].touched">Please enter a valid year.</span>
						</div>
					</div>
					<div class="col-md-2">
						<!-- Pages -->
						<div class="form-group" [ngClass] = "{'has-error': !form.controls['pages'].valid && form.controls['pages'].touched}">
							<label>Pages</label>
							<input type="number" class="form-control" placeholder="Pages" formControlName="pages">
							<span class="help-block" *ngIf="!form.controls['pages'].valid && form.controls['pages'].touched">Please enter a valid number of pages.</span>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<!-- Genres -->
						<div class="form-group">
							<!-- Genres -->
							<book-tags
								title="Genres"
								placeholder="Add genre..."
								iconClass="pe-7s-folder"
								[items]="genres"
								(getItems)="getGenres($event)"
							></book-tags>
						</div>
					</div>
					<div class="col-md-3">
						<!-- Collection -->
						<div class="form-group">
							<label>Collections</label>
							<div class="dropdown">
								<button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
									Add book to a collection
									<span class="caret"></span>
								</button>
								<ul class="dropdown-menu">
									<ng-container *ngIf="allCollections.length" >
										<li *ngFor="let collection of allCollections; let i = index">
											<a href="javascript:void(0);" (click)="moveCollection(allCollections, collections, i)">
												{{collection}}
											</a>
										</li>
									</ng-container>
										<li *ngIf="!allCollections.length">
											<a><i>No collections</i></a>
										</li>
								</ul>
							</div>
							<ng-container *ngFor="let collection of collections; let i = index; let lastItem = last">
								<i class="pe-7s-notebook"></i>
								<a href="javascrip:void(0);"> {{collection}}</a>
								<a href="javascript:void(0);" (click)="moveCollection(collections, allCollections, i)">
									<i class='pe-7s-close-circle' style="font-size: 1.1em"></i>
								</a>
								{{lastItem ? '' : ', '}}
							</ng-container>
						</div>
					</div>
					<div class="col-md-3">
						<!-- Language -->
						<div class="form-group">
							<language-selector [selectedLanguage]="selectedLanguage" (select)="selectedLanguage = $event"></language-selector>
						</div>
					</div>
				</div>
				<div class="row">
					<div class="col-md-6">
						<!-- Tags-->
						<div class="form-group">
							<!-- Tags -->
							<book-tags
								title="Tags"
								placeholder="Add tags..."
								iconClass="pe-7s-ticket"
								[items]="tags"
								(getItems)="getTags($event)"							
							></book-tags>
						</div>
					</div>
					<div class="col-md-3">
						<!-- About -->
						<div class="form-group">
							<book-buttons
								[owned]="!!book.owned"
								[read]="!!book.read"
								[favorite]="!!book.favorite"
								[wishlist]="!!book.wishlist"
							></book-buttons>
						</div>
					</div>
					<div class="col-md-3">
						<!-- Rating -->
						<div class="form-group">
							<label>Rating</label><br>
							<rating style="font-size: 20px" formControlName="rating" [titles]="['', '', '', '', '']"></rating>
						</div>
					</div>
        </div>
        <!-- Image -->
        <div class="row">
					<div class="col-xs-12">
						<!-- Title -->
						<div class="form-group" [ngClass] = "{'has-error': !form.controls['imageLarge'].valid && form.controls['imageLarge'].touched}">
							<label>
                Book Cover
                <a href="javascript:void(0);" (click)="this.form.patchValue({ imageLarge: '', imageSmall: '' })">
                  <i class="pe-7s-close-circle" style="font-size: 100%"></i>
                </a>
              </label>
							<input type="text" class="form-control" placeholder="Link to the book cover" formControlName="imageLarge">
							<span class="help-block" *ngIf="!form.controls['imageLarge'].valid && form.controls['imageLarge'].touched">
								Please enter a valid link to your book cover.
							</span>
						</div>
          </div>
				</div>
				<!-- Notes -->
				<div class="form-group">
					<label>Notes</label>
					<textarea
						formControlName="notes"
						rows="5"
						class="form-control"
						placeholder="Leave notes, thoughts, or a full review of the book here :)"
						value=""
					></textarea>
				</div>
				<hr>
				<div style="text-align: center;">
					<button type="submit" class="btn btn-default" [disabled]="!form.valid">{{button}}</button>
				</div>
			</form>
		</div>
	</div>
</page-navigator>
